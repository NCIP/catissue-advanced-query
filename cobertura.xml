<!-- =================================================================== -->
        <!-- Build file                                                          -->
        <!-- =================================================================== -->
<project name="AdvancedQuery.cobertura" default="instrument" basedir=".">

	
  <!-- =================================================================== -->
  <!-- Instrument class files                                              -->
  <!-- =================================================================== -->
	

	
  <target name="instrument">
  	
  	<delete dir="./cobertura/instrumented"/>
  	<delete file = "./cobertura/coverage.ser"/>
	<mkdir dir="./cobertura/instrumented"/>
  	
    <!-- Remove the coverage data file and any old instrumentation.
    <delete file="${output.cobertura.result.dir}/coverage.ser"/>  -->

    <!--
       Instrument the application classes, writing the
       instrumented classes into ${build.instrumented.dir}.
    -->
    <cobertura-instrument datafile="./cobertura/coverage.ser"
                          todir="./cobertura/instrumented">
      <!--
         The following line causes instrument to ignore any
         source line containing a reference to log4j, for the
         purposes of coverage reporting.
      -->
      <ignore regex="org.apache.log4j.*"/>
	
	  <fileset dir="./WEB-INF/classes">
	  		<include name="**/workflowexecutor/*.class"/>
	  		<include name="**/predicate/*Predicate*.class"/>
	  		<include name="**/impl/*.class"/>
	  		<include name="**/bizlogic/*.class"/>
	  		<include name="**/helper/*.class"/>
	  		<include name="**/category/*.class"/>
	  		<include name="**/spreadsheet/*.class"/>
	  	    <include name="**/htmlprovider/*.class"/>
	  		<include name="**/querysuite/*.class"/>
	  		<include name="**/processor/*.class"/>
	  		<include name="**/DirectedGraph.class"/>
	  		<include name="**/ResultsViewComponentGenerator.class"/>
	  	    <include name="**/QueryParameterUtil.class" />
	  	
	  		<!-- Temporarily excluded since (writing testcases) -->
	  		
	  		<!-- Bean class -->
	  		<exclude name="**/SpreadSheetData.class"/>
	  		<exclude name="**/OutputTreeDataNode.class"/>
	  		<exclude name="**/QueryDetails.class"/>
	  		<exclude name="**/TemporalColumnUIBean.class"/>
	  		<!-- Interface/abstract class -->
	  		<exclude name="**/IQueryGenerator.class"/>
	  		<exclude name="**/AbstractSecurityEventHandler.class"/>
	  		<exclude name="**/AbstractQueryGenerator.class"/>
	  		<exclude name="**/impl/*Test*.class"/>
	      	<exclude name="**/bizlogic/*Test*.class"/>
	      	<exclude name="**/bizlogic/*Factory*.class"/>
	  		<exclude name="**/htmlprovider/*Test*.class"/>
	  		<exclude name="**/*Test*.class"/>
	  		<exclude name="**/*Factory*.class"/>
	  		<exclude name="**/*Constants*.class"/>
	  		<exclude name="**/*Error*.class"/>
	  		<exclude name="**/*Exception*.class"/>
	  		
	  		<exclude name="**/AnnotationUtil.class"/>
	  		<exclude name="**/DefaultQueryBizLogic.class"/>
		  	
	  		<!-- Requires actionForm, hence excluded -->
	  		<exclude name="**/QueryModuleActionUtil.class"/>
	  	
	  		<!-- pvmanager excluded -->
	  		<exclude name="**/pvmanager/**.class"/>
	  		<exclude name="**/pvmanager/impl/**.class"/>
	  			
	  		<exclude name="**/QueryUIManager.class"/>
	  		<exclude name="**/RecentQueriesBizlogic.class"/>
	  		<exclude name="**/SQLLogger.class"/>
	  		<exclude name="**/LocalDEPermissibleValueManager.class"/>
		  	<exclude name="**/MedLookUpManager.class"/>
		  	<exclude name="**/ConceptValue.class"/>
	  </fileset>
    </cobertura-instrument>
  </target>

  <!-- =================================================================== -->
  <!-- Generate converage report                                           -->
  <!-- =================================================================== -->
  <target name="coverage.report">
  		
  	<delete dir="./cobertura/report"/>
   	<mkdir dir="./cobertura/report"/>
  		
    <cobertura-report datafile="./cobertura/coverage.ser" 
    				  srcdir="${basedir}/WEB-INF/src"
                      destdir="./cobertura/report"
                      format="html"/>
  	<cobertura-report datafile="./cobertura/coverage.ser" 
  	    				  srcdir="${basedir}/WEB-INF/src"
  	                      destdir="./cobertura/report"
  	                      format="xml"/>

  </target>


  <!-- =================================================================== -->
  <!-- Fail if coverage is below threshold                                 -->
  <!-- =================================================================== -->
  <target name="coverage.check">
    <cobertura-check datafile="./cobertura/coverage.ser"
                     branchrate="0"
                     linerate="60"
                     totalbranchrate="0"
                     totallinerate="0">
		
  	</cobertura-check> 	
    	
  </target>
  <!--removed the leading '9' for every number ie. 4 is 94, 0 is 90, ...-->

</project>

